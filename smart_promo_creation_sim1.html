<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResCount — Démo : Créer une promotion</title>
  <style>
    :root{
      --primary:#015c2b;
      --danger:#d01416;
      --bg:#f4eac7;

      --panel:#ffffff;
      --panel2:#fbf7e7;
      --text:#1b1b1b;
      --muted:#5c5c5c;
      --shadow: 0 12px 30px rgba(0,0,0,.10);
      --shadow2: 0 18px 50px rgba(0,0,0,.14);
      --r:16px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background: var(--bg);
      color:var(--text);
      line-height:1.35;
    }

    header{
      max-width:980px;
      margin:0 auto;
      padding:18px 14px 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .brand{display:flex; align-items:center; gap:10px;}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background: linear-gradient(135deg, var(--primary), #0a7a3b);
      box-shadow: 0 14px 28px rgba(1,92,43,.18);
      flex:0 0 auto;
    }
    h1{margin:0; font-size:18px; font-weight:1000}
    .sub{margin:0; color:var(--muted); font-size:12.8px; font-weight:800}

    /* Simple legal banner (no IP badge) */
    .legalWrap{max-width:980px;margin:0 auto 12px;padding:0 14px;}
    .legalBanner{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(1,92,43,.18);
      box-shadow: var(--shadow2);
      background:
        radial-gradient(1200px 220px at 20% -20%, rgba(1,92,43,.14), transparent 60%),
        radial-gradient(900px 200px at 80% 0%, rgba(208,20,22,.10), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.78));
      backdrop-filter: blur(10px);
      position:relative;
    }
    .legalBanner::before{
      content:"";
      position:absolute; inset:0;
      background: repeating-linear-gradient(135deg, rgba(1,92,43,.05) 0px, rgba(1,92,43,.05) 10px, transparent 10px, transparent 22px);
      opacity:.55;
      pointer-events:none;
    }
    .legalInner{
      position:relative;
      padding:12px;
      font-size:12.2px;
      font-weight:900;
      color: rgba(27,27,27,.78);
      border-radius:18px;
    }
    .legalInner b{color:var(--danger);}

    main{
      max-width:980px;
      margin:0 auto;
      padding:10px 14px 32px;
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 980px){
      main{grid-template-columns: 1.1fr .9fr;}
    }

    .card{
      background: var(--panel);
      border:1px solid rgba(1,92,43,.18);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0;
      font-size:14.5px;
      padding:14px;
      border-bottom:1px solid rgba(1,92,43,.14);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .content{ padding:14px; }

    .stepTitle{
      font-weight:1000;
      color: var(--primary);
      font-size:13px;
      margin:0 0 10px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .stepDot{
      width:22px;height:22px;border-radius:9px;
      background: rgba(1,92,43,.10);
      border:1px solid rgba(1,92,43,.20);
      display:flex;align-items:center;justify-content:center;
      font-size:12px;
      font-weight:1000;
      color: var(--primary);
      flex:0 0 auto;
    }

    .grid{display:grid; grid-template-columns: 1fr; gap:12px;}
    @media (min-width: 720px){ .grid.two{grid-template-columns: 1fr 1fr;} }

    label{
      display:block;
      font-size:13px;
      font-weight:1000;
      color: var(--primary);
      margin:0 0 6px;
    }
    label::after{
      content:"";
      display:block;
      width:30px;
      height:3px;
      background: linear-gradient(90deg, var(--primary), rgba(1,92,43,.25));
      margin-top:5px;
      border-radius:999px;
    }

    input[type="text"], input[type="number"], input[type="datetime-local"], textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(1,92,43,.22);
      background: rgba(244,234,199,.35);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:80px; resize:vertical;}
    input:focus, textarea:focus, select:focus{
      border-color: rgba(1,92,43,.65);
      box-shadow: 0 0 0 4px rgba(1,92,43,.12);
      background: rgba(244,234,199,.50);
    }

    .hint{margin-top:6px; color:var(--muted); font-size:12.5px; font-weight:800;}
    .divider{height:1px; background: rgba(1,92,43,.14); margin:12px 0;}

    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    .check{
      display:flex; align-items:center; gap:8px;
      padding:10px 12px;
      border:1px solid rgba(1,92,43,.18);
      border-radius:14px;
      background: rgba(244,234,199,.30);
      cursor:pointer;
      user-select:none;
      font-size:14px;
      font-weight:900;
      color: rgba(27,27,27,.84);
    }
    .check input{accent-color: var(--primary);}

    .sliderWrap{
      border:1px solid rgba(1,92,43,.18);
      background: rgba(244,234,199,.30);
      border-radius:14px;
      padding:12px;
    }
    input[type="range"]{width:100%; accent-color: var(--primary);}

    .actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}
    button{
      border:none;
      border-radius:14px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      font-size:14px;
    }
    .btnPrimary{background: var(--primary); color:#ffffff; box-shadow: 0 12px 22px rgba(1,92,43,.18);}
    .btnDanger{background: var(--danger); color:#ffffff; box-shadow: 0 12px 22px rgba(208,20,22,.16);}
    .btnGhost{background: rgba(255,255,255,.75); border:1px solid rgba(1,92,43,.18); color: var(--text);}
    .small{font-size:12.5px;color:var(--muted); margin-top:10px; font-weight:800;}

    .previewCard{
      border:1px solid rgba(1,92,43,.16);
      border-radius:18px;
      overflow:hidden;
      background: var(--panel2);
    }
    .previewTop{display:flex; gap:12px; padding:12px; align-items:flex-start;}
    .thumb{
      width:86px;height:86px;border-radius:14px;
      background: rgba(1,92,43,.08);
      border:1px solid rgba(1,92,43,.18);
      overflow:hidden;
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:center;
      color:rgba(27,27,27,.55);
      font-size:12px;
      font-weight:900;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .pTitle{font-weight:1000; font-size:14.5px; margin:0 0 4px}
    .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:8px}
    .tag{
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(1,92,43,.18);
      background: rgba(255,255,255,.72);
      color: rgba(27,27,27,.75);
      font-weight:1000;
    }
    .tag.primary{border-color: rgba(1,92,43,.35); color: var(--primary);}
    .tag.danger{border-color: rgba(208,20,22,.35); color: var(--danger);}
    .previewBody{padding:0 12px 12px; color: rgba(27,27,27,.78); font-size:13px; font-weight:800;}

    .impactCard{
      border:1px solid rgba(1,92,43,.16);
      background: rgba(244,234,199,.35);
      border-radius:16px;
      padding:12px;
    }
    .impactHeading{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-weight:1000;
      color: var(--primary);
      font-size:13px;
      margin-bottom:10px;
    }
    .impactBig{
      font-size:22px;
      font-weight:1000;
      color: var(--primary);
      letter-spacing:.2px;
    }
    .impactSub{
      margin-top:6px;
      font-size:12.5px;
      color: var(--muted);
      font-weight:900;
    }

    .ctaCard{
      border:1px solid rgba(1,92,43,.18);
      background: rgba(1,92,43,.05);
      border-radius:16px;
      padding:12px;
    }
    .ctaTitle{
      font-weight:1000;
      color: var(--primary);
      font-size:14px;
      margin:0 0 6px;
    }
    .ctaText{
      color: rgba(27,27,27,.80);
      font-size:12.8px;
      font-weight:900;
      margin:0 0 10px;
    }
    .ctaBtns{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;}
    .ctaLink{
      display:inline-block;
      text-decoration:none;
      border-radius:14px;
      padding:12px 14px;
      font-weight:1000;
      font-size:14px;
      cursor:pointer;
    }
    .ctaLink.primary{background: var(--primary); color:#fff; box-shadow: 0 12px 22px rgba(1,92,43,.18);}
    .ctaLink.ghost{background: rgba(255,255,255,.75); border:1px solid rgba(1,92,43,.18); color: var(--text);}

    .contactGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:10px;
    }
    @media (min-width: 720px){ .contactGrid{ grid-template-columns: 1fr 1fr; } }
    .contactItem{
      border:1px solid rgba(1,92,43,.14);
      background: rgba(255,255,255,.72);
      border-radius:14px;
      padding:10px 12px;
      font-size:12.5px;
      font-weight:900;
    }
    .contactItem b{color: var(--primary);}
    .contactItem a{color: var(--primary); font-weight:1000; text-decoration:none;}
    .contactItem a:hover{text-decoration:underline;}

    .warnBox{
      border:1px solid rgba(208,20,22,.22);
      background: rgba(208,20,22,.06);
      padding:10px 12px;
      border-radius:14px;
      color: rgba(208,20,22,.95);
      font-size:12.8px;
      font-weight:1000;
      display:none;
    }

    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center; justify-content:center;
      padding:14px;
      z-index:50;
    }
    .modal{
      width:min(860px, 98vw);
      background: var(--panel);
      border:1px solid rgba(1,92,43,.18);
      border-radius: 18px;
      box-shadow: 0 20px 70px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modalHead{
      padding:14px;
      border-bottom:1px solid rgba(1,92,43,.14);
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
    }
    .modalHead b{font-size:14px; font-weight:1000}
    .x{
      border:1px solid rgba(1,92,43,.18);
      background: rgba(244,234,199,.35);
      color:var(--text);
      width:38px;height:38px;border-radius:14px;
      font-weight:1000;
      cursor:pointer;
    }
    .modalBody{padding:14px}
    .modalGrid{display:grid; grid-template-columns: 1fr; gap:12px;}
    @media (min-width: 860px){ .modalGrid{grid-template-columns: 1.05fr .95fr;} }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      color:#1f2a1f;
      background: rgba(244,234,199,.45);
      border:1px solid rgba(1,92,43,.16);
      border-radius:14px;
      padding:12px;
      overflow:auto;
      white-space:pre-wrap;
      font-weight:800;
    }

    .phone{
      width:min(360px, 100%);
      margin:0 auto;
      border-radius: 26px;
      border: 2px solid rgba(27,27,27,.18);
      background: #0f0f0f;
      padding:12px;
      box-shadow: 0 18px 60px rgba(0,0,0,.22);
    }
    .screen{
      background: #ffffff;
      border-radius: 20px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
    }
    .appTop{
      padding:12px 12px 10px;
      background: var(--primary);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .appTop .ttl{font-weight:1000;font-size:13px;}
    .appTop .chip{
      background: rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.25);
      padding:6px 8px;
      border-radius:999px;
      font-size:11px;
      font-weight:1000;
      white-space:nowrap;
    }
    .appBody{padding:12px; background: #fafafa;}
    .appCard{
      background:#fff;
      border:1px solid rgba(1,92,43,.18);
      border-radius:16px;
      overflow:hidden;
      box-shadow: 0 12px 28px rgba(0,0,0,.08);
    }
    .appCardTop{display:flex; gap:10px; padding:10px; align-items:flex-start;}
    .appImg{
      width:64px;height:64px;border-radius:14px;
      background: rgba(1,92,43,.08);
      border:1px solid rgba(1,92,43,.18);
      overflow:hidden;
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:center;
      color:rgba(27,27,27,.55);
      font-size:11px;
      font-weight:900;
    }
    .appImg img{width:100%;height:100%;object-fit:cover;display:block}
    .appName{font-weight:1000;font-size:13px;margin:0}
    .appSub{color:#555;font-size:11.5px;margin-top:2px; font-weight:800}
    .appBadges{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .badgeSmall{
      font-size:10.5px;
      padding:5px 7px;
      border-radius:999px;
      border:1px solid rgba(1,92,43,.18);
      background: rgba(244,234,199,.35);
      color: rgba(27,27,27,.78);
      font-weight:1000;
    }
    .badgeSmall.primary{color:var(--primary); border-color: rgba(1,92,43,.35);}
    .badgeSmall.danger{color:var(--danger); border-color: rgba(208,20,22,.35);}
    .appCardBody{padding:0 10px 10px; color:#444; font-size:12px; font-weight:800;}
    .appCTA{margin-top:10px; display:flex; gap:8px;}
    .appBtn{
      flex:1;
      border:none;
      border-radius:14px;
      padding:10px 10px;
      font-weight:1000;
      font-size:12.5px;
      cursor:pointer;
    }
    .appBtn.primary{background: var(--primary); color:#fff;}
    .appBtn.ghost{background: #fff; border:1px solid rgba(1,92,43,.18); color:#111;}
    .appFooterNote{margin-top:10px; font-size:11px; color:#666; font-weight:900;}

    footer{
      margin-top:34px;
      padding:22px 14px;
      background:#ffffff;
      border-top:1px solid rgba(1,92,43,.18);
      font-size:11.5px;
      color:#444;
    }
    footer .wrap{max-width:980px;margin:0 auto;line-height:1.55;}
    footer strong{color:#111}
    footer .fine{color:#666; font-weight:800; margin-top:8px}
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Démo ResCount — Créer une promotion</h1>
        <p class="sub">Remplissez les champs ci-dessous : le rendu et l’impact s’affichent automatiquement.</p>
      </div>
    </div>
  </header>

  <main>
    <section class="card">
      <h2>3 étapes simples</h2>

      <div class="content">
        <div class="stepTitle"><span class="stepDot">1</span> Choisir votre offre</div>

        <div class="grid two">
          <div>
            <label for="restaurantName">Nom du restaurant</label>
            <input id="restaurantName" type="text" value="Mon Restaurant" />
            <div class="hint">Exemple : “Chez Maria”, “Sushi Lille Centre”.</div>
          </div>

          <div>
            <label for="template">Type d’offre (modèle)</label>
            <select id="template">
              <option value="bogo_1_1">Achetez 1, recevez 1 gratuit</option>
              <option value="discount_items">Réduction sur des produits</option>
              <option value="free_delivery">Livraison gratuite</option>
              <option value="b1_free_item">Achetez 1, recevez un produit gratuit</option>
              <option value="spend_save">Plus vous dépensez, plus vous économisez</option>
              <option value="happy_hour_2_5">Happy Hour (14h–17h)</option>
              <option value="storewide">Réduction sur toute la carte</option>
              <option value="free_item_purchase">Produit offert avec achat</option>
              <option value="alacarte">Spécial à la carte</option>
            </select>
            <div class="hint" id="templateInfo">—</div>
          </div>
        </div>

        <div class="divider"></div>

        <label>Modes disponibles</label>
        <div class="row">
          <label class="check"><input id="mDineIn" type="checkbox" checked> Sur place</label>
          <label class="check"><input id="mTakeaway" type="checkbox"> À emporter</label>
          <label class="check"><input id="mDelivery" type="checkbox"> Livraison</label>
        </div>

        <div class="divider"></div>

        <label for="desc">Texte simple (ce que le client va lire)</label>
        <textarea id="desc">Offre limitée chaque jour — pensez à réserver tôt.</textarea>

        <div class="divider"></div>

        <label for="image">Image (optionnel)</label>
        <input id="image" type="file" accept="image/*" />

        <div class="divider"></div>

        <label>Catégories (menu)</label>
        <div class="grid" id="categories" style="gap:10px;">
          <div class="row">
            <label class="check"><input type="checkbox" value="Sushi" checked> Sushi</label>
            <label class="check"><input type="checkbox" value="Poke"> Poke</label>
            <label class="check"><input type="checkbox" value="Pizza"> Pizza</label>
          </div>
          <div class="row">
            <label class="check"><input type="checkbox" value="Burgers"> Burgers</label>
            <label class="check"><input type="checkbox" value="Indien"> Indien</label>
            <label class="check"><input type="checkbox" value="Ramen"> Ramen</label>
          </div>
          <div class="row">
            <label class="check"><input type="checkbox" value="Desserts"> Desserts</label>
            <label class="check"><input type="checkbox" value="Boissons"> Boissons</label>
            <label class="check"><input type="checkbox" value="Vegan"> Vegan</label>
          </div>
        </div>

        <div class="divider"></div>

        <div class="stepTitle"><span class="stepDot">2</span> Choisir la période</div>
        <div class="grid two">
          <div>
            <label for="startAt">Début</label>
            <input id="startAt" type="datetime-local" />
          </div>
          <div>
            <label for="endAt">Fin</label>
            <input id="endAt" type="datetime-local" />
          </div>
        </div>
        <div class="small" id="dateMsg"></div>

        <div class="divider"></div>

        <div class="stepTitle"><span class="stepDot">3</span> Limites (simple)</div>
        <div class="grid two">
          <div>
            <label>Coupons par jour (quota)</label>
            <div class="sliderWrap">
              <div class="row" style="justify-content:space-between;">
                <div style="color:var(--muted); font-size:12.5px; font-weight:900;">Max / jour</div>
                <div style="font-weight:1000;color:var(--primary);"><span id="cpdVal">20</span></div>
              </div>
              <input id="couponsPerDay" type="range" min="1" max="200" value="20" />
              <div class="hint">Exemple : 20 coupons maximum par jour.</div>
            </div>
          </div>

          <div>
            <label for="reuseDays">Le client peut revenir après (jours)</label>
            <input id="reuseDays" type="number" min="0" max="60" value="7" />
            <div class="hint">Exemple : 7 = même client après 7 jours.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="actions">
          <button class="btnPrimary" id="publishBtn">Créer & publier (démo)</button>
          <button class="btnGhost" id="resetBtn">Remettre à zéro</button>
          <button class="btnDanger" id="copyBtn">Copier le résumé</button>
        </div>

        <div class="small">Ceci est une démo : aucune vraie publication n’est effectuée.</div>
      </div>
    </section>

    <aside class="card">
      <h2>Aperçu + impact</h2>
      <div class="content">
        <div class="previewCard">
          <div class="previewTop">
            <div class="thumb" id="thumb"><span>Image</span></div>
            <div style="flex:1">
              <div class="pTitle" id="pTitle">—</div>
              <div style="color:var(--muted); font-size:12.5px; font-weight:900;" id="pRestaurant">—</div>
              <div class="tags" id="tags"></div>
            </div>
          </div>
          <div class="previewBody">
            <div id="pDesc">—</div>
            <div class="divider" style="margin:10px 0;"></div>
            <div class="row" style="justify-content:space-between;">
              <div><b>Quota/jour :</b> <span id="pCPD"></span></div>
              <div><b>Retour client :</b> <span id="pReuse"></span></div>
            </div>
            <div class="row" style="justify-content:space-between; margin-top:6px;">
              <div><b>Période :</b> <span id="pPeriod"></span></div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="impactCard">
          <div class="impactHeading">
            <span>Impact projeté</span>
            <span class="tag primary" style="background:rgba(255,255,255,.78);">Estimation</span>
          </div>
          <div class="impactBig"><span id="impactVisits">—</span> visites potentielles</div>
          <div class="impactSub">Basé sur votre quota quotidien et votre période.</div>
        </div>

        <div class="divider"></div>

        <div id="errorMsg" class="warnBox"></div>

        <div class="ctaCard">
          <p class="ctaTitle">Vous voulez le faire pour de vrai ?</p>
          <p class="ctaText">Inscrivez votre restaurant sur notre espace partenaire.</p>

          <div class="ctaBtns">
            <a class="ctaLink primary" href="https://partner.rescount.net/login" target="_blank" rel="noopener">S’inscrire / Se connecter</a>
            <a class="ctaLink ghost" href="mailto:info@rescount.net">Nous écrire</a>
          </div>

          <div class="contactGrid" aria-label="Coordonnées ResCount">
            <div class="contactItem"><b>Téléphone</b><br/><a href="tel:+33672461475">+33 6 72 46 14 75</a></div>
            <div class="contactItem"><b>Email</b><br/><a href="mailto:info@rescount.net">info@rescount.net</a></div>
            <div class="contactItem"><b>Adresse</b><br/>Spaces - Lille, Shake Building,<br/>612 Rue de la chaude rivière, Lille, 59800</div>
            <div class="contactItem"><b>Horaires</b><br/>Lundi - Vendredi : 9h00 - 18h00</div>
          </div>
        </div>

        <div class="divider"></div>
        <div class="small">Résultats indicatifs (non garantis).</div>
      </div>
    </aside>
  </main>

  <!-- Modal -->
  <div class="modalBack" id="modalBack" role="dialog" aria-modal="true" aria-label="Aperçu dans l’app">
    <div class="modal">
      <div class="modalHead">
        <b>✅ Publié (démo) — voici le rendu côté app</b>
        <button class="x" id="closeModal" aria-label="Fermer">✕</button>
      </div>

      <div class="modalBody">
        <div class="modalGrid">
          <div>
            <div class="mono" id="modalSummary"></div>
            <div class="actions" style="margin-top:12px;">
              <button class="btnPrimary" id="copyModalBtn">Copier le résumé</button>
              <button class="btnGhost" id="closeModal2">Fermer</button>
            </div>
          </div>

          <div>
            <div class="phone" aria-label="Aperçu app">
              <div class="screen">
                <div class="appTop">
                  <div class="ttl">ResCount • Offres</div>
                  <div class="chip">Nouvelle promo</div>
                </div>
                <div class="appBody">
                  <div class="appCard">
                    <div class="appCardTop">
                      <div class="appImg" id="appImg">Image</div>
                      <div style="flex:1">
                        <p class="appName" id="appPromoTitle">—</p>
                        <div class="appSub" id="appRestName">—</div>
                        <div class="appBadges" id="appBadges"></div>
                      </div>
                    </div>
                    <div class="appCardBody">
                      <div id="appDesc">—</div>
                      <div class="appCTA">
                        <button class="appBtn primary" type="button">Réclamer</button>
                        <button class="appBtn ghost" type="button">Voir</button>
                      </div>
                      <div class="appFooterNote" id="appFoot">—</div>
                    </div>
                  </div>
                  <div class="appFooterNote" style="margin-top:10px;">Maquette (démo).</div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="wrap">
      <strong>Mentions légales & Propriété</strong><br/><br/>
      Cette page web (contenu, code, design, simulations, concept) est la propriété exclusive de <strong>ResCount</strong>.
      Toute reproduction, réutilisation, copie, modification, diffusion ou exploitation, totale ou partielle, sans autorisation
      écrite préalable, est strictement interdite et pourra donner lieu à des poursuites.
      <div class="fine">© 2026 ResCount. Tous droits réservés.</div>
    </div>
  </footer>

<script>
  const $ = (id) => document.getElementById(id);

  const TEMPLATE_INFO = {
    bogo_1_1: "Le client achète 1 produit et reçoit le 2ème gratuit.",
    discount_items: "Vous appliquez une réduction sur certains produits.",
    free_delivery: "Pas de frais de livraison pour le client (si vous faites la livraison).",
    b1_free_item: "Le client achète 1 produit et vous offrez un petit extra.",
    spend_save: "Le client économise à partir d’un montant minimum (ex : dès 25€).",
    happy_hour_2_5: "Offre valable sur un créneau calme (14h–17h).",
    storewide: "Réduction sur toute la carte (simple à comprendre).",
    free_item_purchase: "Un produit offert si le client achète quelque chose.",
    alacarte: "Offre spéciale sur un produit précis (votre “star”)."
  };

  function fmtDate(dt){
    if(!dt) return "—";
    const d = new Date(dt);
    if(isNaN(d.getTime())) return "—";
    const pad = (n)=> String(n).padStart(2,"0");
    return `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
  }
  function dayDiffInclusive(start, end){
    const s = new Date(start), e = new Date(end);
    if(isNaN(s) || isNaN(e)) return null;
    const s0 = new Date(s.getFullYear(), s.getMonth(), s.getDate());
    const e0 = new Date(e.getFullYear(), e.getMonth(), e.getDate());
    const ms = 24*60*60*1000;
    return Math.floor((e0 - s0)/ms) + 1;
  }
  function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
  function getSelectedCategories(){
    return Array.from(document.querySelectorAll('#categories input[type="checkbox"]:checked'))
      .map(cb => cb.value);
  }
  function setDefaultDates(){
    const now = new Date();
    const in7 = new Date(now.getTime() + 7*24*60*60*1000);
    const pad = (n)=> String(n).padStart(2,"0");
    const toLocalInput = (d)=> `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
    const s = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0);
    const e = new Date(in7.getFullYear(), in7.getMonth(), in7.getDate(), 23, 0);
    $("startAt").value = toLocalInput(s);
    $("endAt").value = toLocalInput(e);
  }
  function visitesProjetees(nbJours, couponsParJour){
    const total = nbJours * couponsParJour;
    return Math.max(0, Math.round(total * 0.65)); // estimation démo
  }

  function updatePreview(){
    const nom = $("restaurantName").value.trim() || "Votre restaurant";
    const key = $("template").value;
    const modele = $("template").selectedOptions[0]?.textContent || "Promotion";
    $("templateInfo").textContent = TEMPLATE_INFO[key] || "—";

    const modes = [];
    if($("mDineIn").checked) modes.push("Sur place");
    if($("mTakeaway").checked) modes.push("À emporter");
    if($("mDelivery").checked) modes.push("Livraison");

    const desc = $("desc").value.trim() || "—";
    const cats = getSelectedCategories();
    const startAt = $("startAt").value;
    const endAt = $("endAt").value;

    const cpd = parseInt($("couponsPerDay").value, 10) || 0;
    const reuse = clamp(parseInt($("reuseDays").value, 10) || 0, 0, 60);

    $("cpdVal").textContent = cpd;

    $("pTitle").textContent = modele;
    $("pRestaurant").textContent = nom;
    $("pDesc").textContent = desc;
    $("pCPD").textContent = `${cpd}`;
    $("pReuse").textContent = `${reuse} jour(s)`;
    $("pPeriod").textContent = `${fmtDate(startAt)} → ${fmtDate(endAt)}`;

    const tagsEl = $("tags");
    tagsEl.innerHTML = "";
    const mkTag = (text, cls="")=>{
      const s = document.createElement("span");
      s.className = `tag ${cls}`.trim();
      s.textContent = text;
      tagsEl.appendChild(s);
    };
    mkTag("ResCount", "primary");
    if(modes.length) mkTag(modes.join(" • "), "primary");
    if(cats.length) mkTag(cats.slice(0,2).join(" • "));
    if(cats.length > 2) mkTag(`+${cats.length-2}`);

    const err = $("errorMsg");
    err.style.display = "none";

    const s = new Date(startAt), e = new Date(endAt);
    let nbJours = dayDiffInclusive(startAt, endAt);

    if(!startAt || !endAt || isNaN(s) || isNaN(e)){
      nbJours = null;
      $("dateMsg").textContent = "Choisissez une date de début et de fin.";
    } else if(e <= s){
      nbJours = null;
      $("dateMsg").textContent = "";
      err.style.display = "block";
      err.textContent = "La date de fin doit être après la date de début.";
    } else {
      $("dateMsg").textContent = `Durée : ${nbJours} jour(s).`;
    }

    $("impactVisits").textContent = nbJours ? visitesProjetees(nbJours, cpd).toLocaleString("fr-FR") : "—";

    // Modal app preview
    $("appPromoTitle").textContent = modele;
    $("appRestName").textContent = nom;
    $("appDesc").textContent = desc;
    $("appFoot").textContent = `Quota : ${cpd}/jour • Retour client : ${reuse} jour(s)`;

    const appBadges = $("appBadges");
    appBadges.innerHTML = "";
    const mkBadge = (text, cls="")=>{
      const b = document.createElement("span");
      b.className = `badgeSmall ${cls}`.trim();
      b.textContent = text;
      appBadges.appendChild(b);
    };
    mkBadge(`${cpd}/jour`, "primary");
    mkBadge(`Retour ${reuse}j`, "primary");
    if(modes.length) mkBadge(modes[0]);
    if(cats.length) mkBadge(cats[0]);
  }

  function handleImage(){
    const file = $("image").files?.[0];
    const thumb = $("thumb");
    const appImg = $("appImg");

    if(!file){
      thumb.innerHTML = "<span>Image</span>";
      appImg.textContent = "Image";
      return;
    }
    const url = URL.createObjectURL(file);

    thumb.innerHTML = "";
    const img1 = document.createElement("img");
    img1.alt = "Aperçu image promotion";
    img1.src = url;
    thumb.appendChild(img1);

    appImg.innerHTML = "";
    const img2 = document.createElement("img");
    img2.alt = "Aperçu image promotion (app)";
    img2.src = url;
    appImg.appendChild(img2);

    img2.onload = ()=> URL.revokeObjectURL(url);
  }

  function buildSummary(){
    const nom = $("restaurantName").value.trim() || "Votre restaurant";
    const modele = $("template").selectedOptions[0]?.textContent || "Promotion";

    const modes = [];
    if($("mDineIn").checked) modes.push("Sur place");
    if($("mTakeaway").checked) modes.push("À emporter");
    if($("mDelivery").checked) modes.push("Livraison");

    const desc = $("desc").value.trim() || "—";
    const cats = getSelectedCategories();
    const startAt = $("startAt").value;
    const endAt = $("endAt").value;
    const cpd = parseInt($("couponsPerDay").value, 10) || 0;
    const reuse = clamp(parseInt($("reuseDays").value, 10) || 0, 0, 60);

    const nbJours = dayDiffInclusive(startAt, endAt);
    const proj = nbJours ? visitesProjetees(nbJours, cpd).toLocaleString("fr-FR") : "—";

    return [
      `RESCOUNT — DÉMO PROMOTION`,
      `Restaurant : ${nom}`,
      `Offre : ${modele}`,
      `Modes : ${modes.length ? modes.join(", ") : "—"}`,
      `Catégories : ${cats.length ? cats.join(", ") : "—"}`,
      `Période : ${fmtDate(startAt)} → ${fmtDate(endAt)}`,
      `Quota/jour : ${cpd}`,
      `Retour client : ${reuse} jour(s)`,
      ``,
      `Texte : ${desc}`,
      ``,
      `Impact projeté : ${proj} visites potentielles (estimation)`
    ].join("\n");
  }

  async function copyText(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }
  }

  function bind(){
    const ids = ["restaurantName","template","mDineIn","mTakeaway","mDelivery","desc","startAt","endAt","couponsPerDay","reuseDays"];
    ids.forEach(id=>{
      const el = $(id);
      el.addEventListener("input", updatePreview);
      el.addEventListener("change", updatePreview);
    });

    document.querySelectorAll('#categories input[type="checkbox"]').forEach(cb=>{
      cb.addEventListener("change", updatePreview);
    });

    $("image").addEventListener("change", ()=>{
      handleImage();
      updatePreview();
    });

    $("resetBtn").addEventListener("click", ()=>{
      $("restaurantName").value = "Mon Restaurant";
      $("template").value = "bogo_1_1";
      $("mDineIn").checked = true;
      $("mTakeaway").checked = false;
      $("mDelivery").checked = false;
      $("desc").value = "Offre limitée chaque jour — pensez à réserver tôt.";
      $("couponsPerDay").value = 20;
      $("reuseDays").value = 7;
      $("image").value = "";
      $("thumb").innerHTML = "<span>Image</span>";
      $("appImg").textContent = "Image";

      document.querySelectorAll('#categories input[type="checkbox"]').forEach(cb=>{
        cb.checked = (cb.value === "Sushi");
      });

      setDefaultDates();
      updatePreview();
    });

    $("copyBtn").addEventListener("click", async ()=>{
      const ok = await copyText(buildSummary());
      $("copyBtn").textContent = ok ? "Copié ✓" : "Échec copie";
      setTimeout(()=> $("copyBtn").textContent = "Copier le résumé", 1100);
    });

    $("publishBtn").addEventListener("click", ()=>{
      const s = new Date($("startAt").value);
      const e = new Date($("endAt").value);
      if(isNaN(s) || isNaN(e) || e <= s){
        $("errorMsg").style.display = "block";
        $("errorMsg").textContent = "Vérifiez les dates : la fin doit être après le début.";
        return;
      }
      $("modalSummary").textContent = buildSummary();
      $("modalBack").style.display = "flex";
    });

    $("closeModal").addEventListener("click", ()=> $("modalBack").style.display = "none");
    $("closeModal2").addEventListener("click", ()=> $("modalBack").style.display = "none");
    $("modalBack").addEventListener("click", (e)=>{
      if(e.target === $("modalBack")) $("modalBack").style.display = "none";
    });

    $("copyModalBtn").addEventListener("click", async ()=>{
      const ok = await copyText($("modalSummary").textContent);
      $("copyModalBtn").textContent = ok ? "Copié ✓" : "Échec copie";
      setTimeout(()=> $("copyModalBtn").textContent = "Copier le résumé", 1100);
    });

    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape") $("modalBack").style.display = "none";
    });
  }

  setDefaultDates();
  bind();
  updatePreview();
</script>
</body>
</html>